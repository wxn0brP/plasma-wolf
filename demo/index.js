function y(t){return new Promise((e)=>setTimeout(e,t))}(()=>{var t=Object.defineProperty,e=(n,o)=>t(n,"name",{value:o,configurable:!0}),i={html(n){return n!==void 0?(this.innerHTML=n,this):this.innerHTML},v(n){return n!==void 0?(this.value=n,this):this.value},on(n,o){return this.addEventListener(n,o),this},css(n,o=null){return typeof n=="string"?o!==null?this.style[n]=o:this.style.cssText=n:Object.assign(this.style,n),this},attrib(n,o=null){return o!==null?(this.setAttribute(n,o),this):this.getAttribute(n)||""},clA(...n){return this.classList.add(...n),this},clR(...n){return this.classList.remove(...n),this},clT(n,o){return this.classList.toggle(n,o),this},animateFade(n,o={}){let{time:c=200,cb:r}=o,l=this,a=n===0?1:0,p=Math.min(1,Math.max(0,n)),f=performance.now();l.style.opacity=p.toString();function u(b){let $=b-f,T=Math.min($/c,1),I=p+(a-p)*T;l.style.opacity=I.toString(),T<1?requestAnimationFrame(u):(l.style.opacity=a.toString(),r?.())}return e(u,"step"),requestAnimationFrame(u),this},fadeIn(...n){let o=s({display:"string",cb:"function",time:"number"},n),{display:c="block"}=o;return this.css("display",c),this.animateFade(0,o),this.fade=!0,this},fadeOut(...n){let o=s({cb:"function",time:"number"},n),c=o.time??300;return o.time=c,this.animateFade(1,{...o,cb:e(()=>{this.css("display","none"),o.cb?.()},"cb")}),this.fade=!1,this},async fadeInP(...n){return new Promise((o)=>{this.fadeIn(...n,()=>o(this))})},async fadeOutP(...n){return new Promise((o)=>{this.fadeOut(...n,()=>o(this))})},fade:!0,fadeToggle(){return this.fade?this.fadeOut():this.fadeIn(),this},add(n){return this.appendChild(n),this},addUp(n){return this.insertBefore(n,this.firstChild),this},qs(n,o=0){return o&&(n=`[data-id="${n}"]`),this.querySelector(n)},qi(n,o=0){return this.qs(n,o)}};function s(n,o){let c={};if(o.length===0)return c;if(o.every((r)=>typeof r=="object"))return Object.assign({},...o);for(let r of o)for(let[l,a]of Object.entries(n))if(typeof r===a){c[l]=r;break}return c}e(s,"convert"),Object.assign(HTMLElement.prototype,i),Object.assign(document,i),Object.assign(document.body,i),Object.assign(document.documentElement,i);for(let n of["qs","qi"])typeof i[n]=="function"&&(window[n]=function(...o){return i[n].apply(document,o)})})();var x=qs("#FD-message"),_=qs("#FD-prompt"),P=(t,...e)=>{return t.replace(/\\\$|(?<!\\)\$/g,(i)=>{if(i==="\\$")return"$";return e.shift()?.toString()||"$"})};async function H(t,e={}){e={displayTime:6000,...e};let i=document.createElement("div");if(i.innerHTML=t,i.style.top=`-${i.offsetHeight+20}px`,e.className)i.classList.add(e.className);if(e.backgroundColor)i.style.backgroundColor=e.backgroundColor;let s=10,n=o();function o(){let l=0;for(let a of x.children)l+=a.offsetHeight+s;return l}let c=!1;async function r(){c=!0,i.style.top=`-${i.offsetHeight+20}px`,await y(700);for(let l of x.children){let a=l,p=parseInt(a.style.top.replace("px",""));a.style.top=`${p-s-i.offsetHeight}px`}i.remove()}if(i.addEventListener("click",r),e.onClick)i.addEventListener("click",e.onClick);if(x.appendChild(i),await y(100),i.style.top=`${10+n}px`,await y(e.displayTime-700),c)return;await r()}async function d(t,e={}){e={extraTime:0,...e};let i=0.3333333333333333,n={displayTime:(t.split(" ").length*i+6+e.extraTime)*1000,className:"uiMsg"};if(e.onClick)n.onClick=e.onClick;H(t,n)}async function R(t,...e){let i="";if(e.length>0){if(Array.isArray(e[0]))i=e.shift()}t=P(t,...e)+i,d(t)}async function X(t,e=""){return new Promise((i)=>{function s(){i(o.value),n.fadeOut(),setTimeout(()=>{n.remove()},2000)}let n=document.createElement("div");n.style.opacity="0",n.classList.add("prompt"),n.innerHTML="<p>"+t+"<p><br />";let o=document.createElement("input");o.type="text",o.value=e,o.addEventListener("keydown",(r)=>{if(r.key=="Enter")s()}),n.appendChild(o),setTimeout(()=>{o.focus()},100),n.appendChild(document.createElement("br"));let c=document.createElement("button");c.innerHTML="OK",n.appendChild(c),c.addEventListener("click",s),_.appendChild(n),n.fadeIn()})}async function z(t,e="OK",i="Cancel"){return new Promise((s)=>{function n(p){return()=>{s(p),o.fadeOut(),setTimeout(()=>{o.remove()},2000)}}let o=document.createElement("div");o.style.opacity="0",o.classList.add("prompt"),o.innerHTML="<p>"+t+"<p><br />";let c=document.createElement("div");c.style.display="flex",c.style.justifyContent="space-evenly";let r=document.createElement("button");r.innerHTML=i||"Cancel",r.addEventListener("click",n(!1)),c.appendChild(r);let l=document.createElement("button");l.innerHTML=e||"OK",l.addEventListener("click",n(!0)),c.appendChild(l);function a(p){if(p.key=="Enter")n(!0)();else if(p.key=="Escape")n(!1)();document.removeEventListener("keydown",a)}document.addEventListener("keydown",a),setTimeout(()=>{l.focus()},100),o.appendChild(c),_.appendChild(o),o.fadeIn()})}async function A(t,e,i=[],s=[]){return new Promise((n)=>{function o(){n(r.value),c.fadeOut(),setTimeout(()=>{c.remove()},2000)}let c=document.createElement("div");c.style.opacity="0",c.classList.add("prompt"),c.innerHTML="<p>"+t+"<p><br />";let r=document.createElement("select");for(let a=0;a<s.length;a++){let p=s[a],f=document.createElement("optgroup");f.label=p.name;for(let u=0;u<p.options.length;u++){let b=document.createElement("option");b.value=p.options[u]||p.options[u],b.innerHTML=p.options[u],f.appendChild(b)}r.appendChild(f)}for(let a=0;a<e.length;a++){let p=document.createElement("option");p.value=i[a]||e[a],p.innerHTML=e[a],r.appendChild(p)}r.querySelector("option").selected=!0,c.appendChild(r),c.appendChild(document.createElement("br"));let l=document.createElement("button");l.innerHTML="OK",c.appendChild(l),l.addEventListener("click",o),_.appendChild(c),c.fadeIn()})}async function Y(t,e="datetime-local",i,s){return new Promise((n)=>{function o(){n(r.value),c.fadeOut(),setTimeout(()=>{c.remove()},2000)}let c=document.createElement("div");c.style.opacity="0",c.classList.add("prompt"),c.innerHTML="<p>"+t+"<p><br />";let r=document.createElement("input");if(r.type=e,r.value="00:00",i)r.min=new Date(i).toISOString();if(s)r.max=new Date(s).toISOString();r.addEventListener("keydown",(a)=>{if(a.key=="Enter")o()}),c.appendChild(r),setTimeout(()=>{r.focus()},100),c.appendChild(document.createElement("br"));let l=document.createElement("button");l.innerHTML="OK",c.appendChild(l),l.addEventListener("click",o),_.appendChild(c),c.fadeIn()})}window.FD={uiMessage:H,uiMsg:d,uiMsgT:R,confirm:z,prompt:X,selectPrompt:A,promptTime:Y};class w{dx;dy;constructor(t,e){this.dx=t;this.dy=e}}function v(t,e,i=55){let{dx:s,dy:n}=t;if(s===0&&n===0)return e;let o=Math.abs(s),c=Math.abs(n);if(o<i&&c<i)return e;let r=B(t),l=360/e/2,a=r+90+l;return q(a,e)}function B(t){let e=Math.atan2(t.dy,t.dx);if(e=e*(180/Math.PI),e<0)e+=360;return e}function q(t,e){let i=360/e,s=Math.floor(t/i);return s=s%e,s}function M({dx:t,dy:e}){return Math.sqrt(t*t+e*e)}function F(t,e){let i=[],s=2*Math.PI/e;for(let n=0;n<e;n++){let o=n*s-Math.PI/2,c=t*Math.cos(o),r=t*Math.sin(o);i.push(Math.round(c),Math.round(r))}return i}function E(t,e,i,s){return new w(i-t,s-e)}function g(t){let s=102+6*t;if(t>8)s+=(t-8)*4;return s}class L{parent;radius;constructor(t,e=0){this.parent=t;this.radius=e;this.parent.innerHTML="",this._actualRadius=e}body=[];selectedClass="selected";_actualRadius;genBody(t,e){this.parent.innerHTML="",this.body=[];let i=F(this._getRadius(t.length),t.length);for(let n=0;n<t.length;n++){let o=document.createElement("div");o.classList.add("wolf-menu-item"),o.style.left=`${i[n*2]}px`,o.style.top=`${i[n*2+1]}px`,o.innerHTML=t[n].name,this.parent.appendChild(o),this.body.push(o)}let s=document.createElement("div");s.classList.add("wolf-menu-item"),s.classList.add("wolf-menu-item-cancel"),s.style.left="0",s.style.top="0",s.innerHTML=e.name,this.parent.appendChild(s),this.body.push(s)}_getRadius(t){if(this.radius===0)this._actualRadius=g(t);else this._actualRadius=this.radius;return this._actualRadius}clearSelected(){this.body.forEach((t)=>t.classList.remove(this.selectedClass))}select(t){this.body[t].classList.add(this.selectedClass)}}class D{_events={};on(t,e){let i=t;if(!this._events[i])this._events[i]=[];this._events[i].push(e)}once(t,e){let i=(...s)=>{this.off(t,i),e(...s)};this.on(t,i)}off(t,e){let i=t;if(!this._events[i])return;this._events[i]=this._events[i].filter((s)=>s!==e)}emit(t,...e){let i=this._events[t];if(i&&i.length>0)i.forEach((s)=>{s(...e)})}listenerCount(t){return this._events[t]?.length||0}}class k{_commands;_element;constructor(t,e){this._commands=t;this._element=e;let i=document.createElement("div");i.classList.add("wolf-menu-items"),this._element.appendChild(i),this.body=new L(i),this._element.style.display="none"}_x=0;_y=0;_startX=0;_startY=0;_active=!1;_selectedCommands;_logFn=console.log;_cancelCommand={name:"Cancel",action:()=>{}};body;emitter=new D;distanceAccept=!0;distanceCount=60;startCommand="start";init(){this._initMove(),this._initClick(),this.emitter.emit("initialized")}_initMove(){document.addEventListener("mousemove",(t)=>{if(this._x=t.clientX,this._y=t.clientY,!this._active)return;this.body.clearSelected();let e=E(this._startX,this._startY,this._x,this._y),i=v(e,this._selectedCommands.length);this.body.select(i);let s=M(e);if(this.emitter.emit("distance",s,i),!this.distanceAccept)return;if(s>this.body._actualRadius+this.distanceCount)this._selected()})}_initClick(){document.addEventListener("click",(t)=>{if(this._x=t.clientX,this._y=t.clientY,this._active)this._selected();else this._openMenu()})}_openMenu(t=this.startCommand){if(this._selectedCommands=this._commands[t],!this._selectedCommands)return this._logFn(`Command "${t}" not found!`);this._element.style.display="",this._element.style.top=this._y+"px",this._element.style.left=this._x+"px",this.body.genBody(this._selectedCommands,this._cancelCommand),this._active=!0,this._setStart(),this.body.select(this.getDirection()),this.emitter.emit("menuOpened",t)}_selected(){this._element.style.display="none",this._active=!1;let t=this.getDirection(),e=t>this._selectedCommands.length?this._cancelCommand:this._selectedCommands[t];if(this.emitter.emit("menuClosed"),!e)return;if(this.emitter.emit("commandSelected",e),"go"in e){this._openMenu(e.go);return}if("action"in e)e.action(),this.emitter.emit("commandExecuted",e);else this._logFn("Unknown command type",e)}getDirection(t){if(!t)t=E(this._startX,this._startY,this._x,this._y);return v(t,this._selectedCommands.length)}_setStart(t=this._x,e=this._y){this._startX=t,this._startY=e}setRadius(t){this.body.radius=t}go(t){this._openMenu(t)}}var m={hasTorch:!1,hasSword:!1,hasKey:!1,wolfDefeated:!1,guardBribed:!1},h={start:[{name:"Go to the forest",go:"forest"},{name:"Enter the castle",go:"castle"},{name:"Return to the village",go:"village"},{name:"Explore the cave",go:"cave"}],forest:[{name:"Gather berries",action:()=>d("You gathered some delicious berries. They look tasty!")},{name:"Search for useful items",action:K},{name:"Find a stream",action:()=>d("You found a stream with cool, clear water. You take a drink.")},{name:"Go deeper in the forest",go:"deep_forest"},{name:"Return to the start",go:"start"}],deep_forest:[{name:"Investigate strange sounds",action:W},{name:"Look for herbs",action:()=>d("You find some medicinal herbs that might be useful.")},{name:"Return to forest edge",go:"forest"}],castle:[{name:"Enter the throne room",go:"throne_room"},{name:"Talk to the guard",action:j},{name:"Explore the garden",action:()=>d("The garden is beautiful but empty. You notice a small key hidden under a bench!")},{name:"Enter the dungeon",go:"dungeon"},{name:"Return to the start",go:"start"}],throne_room:[{name:"Approach the throne",action:J},{name:"Examine the treasure chest",action:Q},{name:"Return to castle entrance",go:"castle"}],dungeon:[{name:"Search the cells",action:U},{name:"Listen for voices",action:()=>d("You hear faint whispers but can't make out the words.")},{name:"Return upstairs",go:"castle"}],village:[{name:"Talk to the blacksmith",action:G},{name:"Visit the shopkeeper",action:()=>d("Shopkeeper: 'Welcome! I have various goods for sale.'")},{name:"Help the beggar",action:N},{name:"Return to the start",go:"start"}],cave:[{name:"Go deeper",go:"deep_cave"},{name:"Search near entrance",action:Z},{name:"Light a match",action:()=>{if(m.hasTorch)d("Your torch illuminates the cave perfectly.");else d("The match flickers and casts a small, warm glow, but quickly burns out.")}},{name:"Return to the start",go:"start"}],deep_cave:[{name:"Explore the left tunnel",action:S},{name:"Explore the right tunnel",action:V},{name:"Return to cave entrance",go:"cave"}]};function K(){if(Math.random()>0.5&&!m.hasTorch)m.hasTorch=!0,d("You found an old but usable torch! This will help in dark places.");else d("You search the area but find nothing of interest.")}function W(){if(m.hasSword&&!m.wolfDefeated)m.wolfDefeated=!0,d("With your sword, you bravely defeat the wolf! The forest is safe now."),h.deep_forest=h.deep_forest.filter((t)=>t.name!=="Investigate strange sounds"),h.deep_forest.unshift({name:"Examine wolf's den",action:()=>d("In the den you find a small treasure! Your adventure is complete!")});else if(!m.wolfDefeated)d("A fierce wolf appears! You need a weapon to face it. You retreat quickly.")}function j(){if(m.guardBribed)d("Guard: 'Welcome back, friend. The throne room awaits.'");else d("Guard: 'Halt! None may pass without the king's permission... though I might be persuaded for some berries.'")}function G(){if(!m.hasSword)m.hasSword=!0,d("Blacksmith: 'Ah, a brave adventurer! Take this sword - it might help you on your journey.'");else d("Blacksmith: 'That sword looks good on you! Come back if you need it sharpened.'")}function N(){if(d("Beggar: 'Thank you for your kindness! I heard the castle guard has a weakness for forest berries...'"),!h.castle.find((t)=>t.name==="Bribe guard with berries"))h.castle.push({name:"Bribe guard with berries",action:()=>{m.guardBribed=!0,d("The guard happily accepts the berries and lets you pass to the throne room!")}})}function J(){if(m.guardBribed||m.hasKey)d("You approach the empty throne. On it rests a royal decree granting you hero status!");else d("The guard stops you: 'I cannot let you approach the throne without proper authorization!'")}function Q(){if(m.hasKey)d("You unlock the chest with your key and find legendary treasure! You win!");else d("The treasure chest is securely locked. You'll need a key to open it.")}function U(){if(!m.hasKey)m.hasKey=!0,d("In a dusty corner, you find an old iron key! This might open something important.");else d("The dungeon cells are empty and creepy. You don't want to stay here long.")}function Z(){if(!m.hasTorch)d("It's too dark to see anything properly. You need a light source.");else d("With your torch, you find ancient markings on the wall pointing to hidden tunnels.")}function S(){if(m.hasTorch)d("The left tunnel leads to a beautiful crystal cavern. The crystals glow in your torchlight.");else d("It's pitch black! You stumble in the darkness and decide to turn back.")}function V(){d("The right tunnel slopes downward and ends at an underground lake. The water seems to glow with a faint blue light.")}var O=qs(".wolf"),C=new k(h,O);C.init();C.emitter.on("distance",(t)=>{let e=C.body._actualRadius+C.distanceCount,s=`color-mix(in srgb, var(--accent) ${Math.min(100,Math.max(0,Math.round(t/e*100)))}%, white)`;O.style.setProperty("--color",s)});export{h as commands};

//# debugId=E123EDD9E48F0B1E64756E2164756E21
//# sourceMappingURL=index.js.map
