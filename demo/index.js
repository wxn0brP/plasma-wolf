function _(t){return new Promise((n)=>setTimeout(n,t))}(()=>{var t=Object.defineProperty,n=(e,o)=>t(e,"name",{value:o,configurable:!0}),i={html(e){return e!==void 0?(this.innerHTML=e,this):this.innerHTML},v(e){return e!==void 0?(this.value=e,this):this.value},on(e,o){return this.addEventListener(e,o),this},css(e,o=null){return typeof e=="string"?o!==null?this.style[e]=o:this.style.cssText=e:Object.assign(this.style,e),this},attrib(e,o=null){return o!==null?(this.setAttribute(e,o),this):this.getAttribute(e)||""},clA(...e){return this.classList.add(...e),this},clR(...e){return this.classList.remove(...e),this},clT(e,o){return this.classList.toggle(e,o),this},animateFade(e,o={}){let{time:l=200,cb:s}=o,m=this,p=e===0?1:0,r=Math.min(1,Math.max(0,e)),b=performance.now();m.style.opacity=r.toString();function f(y){let P=y-b,w=Math.min(P/l,1),R=r+(p-r)*w;m.style.opacity=R.toString(),w<1?requestAnimationFrame(f):(m.style.opacity=p.toString(),s?.())}return n(f,"step"),requestAnimationFrame(f),this},fadeIn(...e){let o=a({display:"string",cb:"function",time:"number"},e),{display:l="block"}=o;return this.css("display",l),this.animateFade(0,o),this.fade=!0,this},fadeOut(...e){let o=a({cb:"function",time:"number"},e),l=o.time??300;return o.time=l,this.animateFade(1,{...o,cb:n(()=>{this.css("display","none"),o.cb?.()},"cb")}),this.fade=!1,this},async fadeInP(...e){return new Promise((o)=>{this.fadeIn(...e,()=>o(this))})},async fadeOutP(...e){return new Promise((o)=>{this.fadeOut(...e,()=>o(this))})},fade:!0,fadeToggle(){return this.fade?this.fadeOut():this.fadeIn(),this},add(e){return this.appendChild(e),this},addUp(e){return this.insertBefore(e,this.firstChild),this},qs(e,o=0){return o&&(e=`[data-id="${e}"]`),this.querySelector(e)},qi(e,o=0){return this.qs(e,o)}};function a(e,o){let l={};if(o.length===0)return l;if(o.every((s)=>typeof s=="object"))return Object.assign({},...o);for(let s of o)for(let[m,p]of Object.entries(e))if(typeof s===p){l[m]=s;break}return l}n(a,"convert"),Object.assign(HTMLElement.prototype,i),Object.assign(document,i),Object.assign(document.body,i),Object.assign(document.documentElement,i);for(let e of["qs","qi"])typeof i[e]=="function"&&(window[e]=function(...o){return i[e].apply(document,o)})})();var v=qs("#FD-message"),C=qs("#FD-prompt"),X=(t,...n)=>{return t.replace(/\\\$|(?<!\\)\$/g,(i)=>{if(i==="\\$")return"$";return n.shift()?.toString()||"$"})};async function M(t,n={}){n={displayTime:6000,...n};let i=document.createElement("div");if(i.innerHTML=t,i.style.top=`-${i.offsetHeight+20}px`,n.className)i.classList.add(n.className);if(n.backgroundColor)i.style.backgroundColor=n.backgroundColor;let a=10,e=o();function o(){let m=0;for(let p of v.children)m+=p.offsetHeight+a;return m}let l=!1;async function s(){l=!0,i.style.top=`-${i.offsetHeight+20}px`,await _(700);for(let m of v.children){let p=m,r=parseInt(p.style.top.replace("px",""));p.style.top=`${r-a-i.offsetHeight}px`}i.remove()}if(i.addEventListener("click",s),n.onClick)i.addEventListener("click",n.onClick);if(v.appendChild(i),await _(100),i.style.top=`${10+e}px`,await _(n.displayTime-700),l)return;await s()}async function c(t,n={}){n={extraTime:0,...n};let i=0.3333333333333333,e={displayTime:(t.split(" ").length*i+6+n.extraTime)*1000,className:"uiMsg"};if(n.onClick)e.onClick=n.onClick;M(t,e)}async function z(t,...n){let i="";if(n.length>0){if(Array.isArray(n[0]))i=n.shift()}t=X(t,...n)+i,c(t)}async function E(t,n=""){return new Promise((i)=>{function a(){i(o.value),e.fadeOut(),setTimeout(()=>{e.remove()},2000)}let e=document.createElement("div");e.style.opacity="0",e.classList.add("prompt"),e.innerHTML="<p>"+t+"<p><br />";let o=document.createElement("input");o.type="text",o.value=n,o.addEventListener("keydown",(s)=>{if(s.key=="Enter")a()}),e.appendChild(o),setTimeout(()=>{o.focus()},100),e.appendChild(document.createElement("br"));let l=document.createElement("button");l.innerHTML="OK",e.appendChild(l),l.addEventListener("click",a),C.appendChild(e),e.fadeIn()})}async function A(t,n="OK",i="Cancel"){return new Promise((a)=>{function e(r){return()=>{a(r),o.fadeOut(),setTimeout(()=>{o.remove()},2000)}}let o=document.createElement("div");o.style.opacity="0",o.classList.add("prompt"),o.innerHTML="<p>"+t+"<p><br />";let l=document.createElement("div");l.style.display="flex",l.style.justifyContent="space-evenly";let s=document.createElement("button");s.innerHTML=i||"Cancel",s.addEventListener("click",e(!1)),l.appendChild(s);let m=document.createElement("button");m.innerHTML=n||"OK",m.addEventListener("click",e(!0)),l.appendChild(m);function p(r){if(r.key=="Enter")e(!0)();else if(r.key=="Escape")e(!1)();document.removeEventListener("keydown",p)}document.addEventListener("keydown",p),setTimeout(()=>{m.focus()},100),o.appendChild(l),C.appendChild(o),o.fadeIn()})}async function Y(t,n,i=[],a=[]){return new Promise((e)=>{function o(){e(s.value),l.fadeOut(),setTimeout(()=>{l.remove()},2000)}let l=document.createElement("div");l.style.opacity="0",l.classList.add("prompt"),l.innerHTML="<p>"+t+"<p><br />";let s=document.createElement("select");for(let p=0;p<a.length;p++){let r=a[p],b=document.createElement("optgroup");b.label=r.name;for(let f=0;f<r.options.length;f++){let y=document.createElement("option");y.value=r.options[f]||r.options[f],y.innerHTML=r.options[f],b.appendChild(y)}s.appendChild(b)}for(let p=0;p<n.length;p++){let r=document.createElement("option");r.value=i[p]||n[p],r.innerHTML=n[p],s.appendChild(r)}s.querySelector("option").selected=!0,l.appendChild(s),l.appendChild(document.createElement("br"));let m=document.createElement("button");m.innerHTML="OK",l.appendChild(m),m.addEventListener("click",o),C.appendChild(l),l.fadeIn()})}async function B(t,n="datetime-local",i,a){return new Promise((e)=>{function o(){e(s.value),l.fadeOut(),setTimeout(()=>{l.remove()},2000)}let l=document.createElement("div");l.style.opacity="0",l.classList.add("prompt"),l.innerHTML="<p>"+t+"<p><br />";let s=document.createElement("input");if(s.type=n,s.value="00:00",i)s.min=new Date(i).toISOString();if(a)s.max=new Date(a).toISOString();s.addEventListener("keydown",(p)=>{if(p.key=="Enter")o()}),l.appendChild(s),setTimeout(()=>{s.focus()},100),l.appendChild(document.createElement("br"));let m=document.createElement("button");m.innerHTML="OK",l.appendChild(m),m.addEventListener("click",o),C.appendChild(l),l.fadeIn()})}window.FD={uiMessage:M,uiMsg:c,uiMsgT:z,confirm:A,prompt:E,selectPrompt:Y,promptTime:B};class F{dx;dy;constructor(t,n){this.dx=t;this.dy=n}}function L(t,n,i=55){let{dx:a,dy:e}=t;if(a===0&&e===0)return n;let o=Math.abs(a),l=Math.abs(e);if(o<i&&l<i)return n;let s=q(t),m=360/n/2,p=s+90+m;return K(p,n)}function q(t){let n=Math.atan2(t.dy,t.dx);if(n=n*(180/Math.PI),n<0)n+=360;return n}function K(t,n){let i=360/n,a=Math.floor(t/i);return a=a%n,a}function g({dx:t,dy:n}){return Math.sqrt(t*t+n*n)}function O(t,n){let i=[],a=2*Math.PI/n;for(let e=0;e<n;e++){let o=e*a-Math.PI/2,l=t*Math.cos(o),s=t*Math.sin(o);i.push(Math.round(l),Math.round(s))}return i}function D(t,n,i,a){return new F(i-t,a-n)}function $(t){let a=102+6*t;if(t>8)a+=(t-8)*4;return a}class k{parent;radius;constructor(t,n=0){this.parent=t;this.radius=n;this.parent.innerHTML="",this._actualRadius=n}body=[];selectedClass="selected";_actualRadius;genBody(t,n){this.parent.innerHTML="",this.body=[];let i=O(this._getRadius(t.length),t.length);for(let e=0;e<t.length;e++){let o=document.createElement("div");o.classList.add("wolf-menu-item"),o.style.left=`${i[e*2]}px`,o.style.top=`${i[e*2+1]}px`,o.innerHTML=t[e].name,this.parent.appendChild(o),this.body.push(o)}let a=document.createElement("div");a.classList.add("wolf-menu-item"),a.classList.add("wolf-menu-item-cancel"),a.style.left="0",a.style.top="0",a.innerHTML=n.name,this.parent.appendChild(a),this.body.push(a)}_getRadius(t){if(this.radius===0)this._actualRadius=$(t);else this._actualRadius=this.radius;return this._actualRadius}clearSelected(){this.body.forEach((t)=>t.classList.remove(this.selectedClass))}select(t){this.body[t].classList.add(this.selectedClass)}}class T{_events={};on(t,n){let i=t;if(!this._events[i])this._events[i]=[];this._events[i].push(n)}once(t,n){let i=(...a)=>{this.off(t,i),n(...a)};this.on(t,i)}off(t,n){let i=t;if(!this._events[i])return;this._events[i]=this._events[i].filter((a)=>a!==n)}emit(t,...n){let i=this._events[t];if(i&&i.length>0)i.forEach((a)=>{a(...n)})}listenerCount(t){return this._events[t]?.length||0}}class H{_commands;_element;constructor(t,n){this._commands=t;this._element=n;let i=document.createElement("div");i.classList.add("wolf-menu-items"),this._element.appendChild(i),this.body=new k(i),this._element.style.display="none"}_x=0;_y=0;_startX=0;_startY=0;_active=!1;_selectedCommands;_logFn=console.log;_cancelCommand={name:"Cancel",action:()=>{}};body;emitter=new T;distanceAccept=!0;distanceCount=60;startCommand="start";init(){this._initMove(),this._initClick(),this.emitter.emit("initialized")}_initMove(){document.addEventListener("mousemove",(t)=>{if(this._x=t.clientX,this._y=t.clientY,!this._active)return;this.body.clearSelected();let n=D(this._startX,this._startY,this._x,this._y),i=L(n,this._selectedCommands.length);this.body.select(i);let a=g(n);if(this.emitter.emit("distance",a,i),!this.distanceAccept)return;if(a>this.body._actualRadius+this.distanceCount)this._selected()})}_initClick(){document.addEventListener("click",(t)=>{if(this._x=t.clientX,this._y=t.clientY,this._active)this._selected();else this._openMenu()})}_openMenu(t=this.startCommand){if(this._selectedCommands=this._commands[t],!this._selectedCommands)return this._logFn(`Command "${t}" not found!`);this._element.style.display="",this._element.style.top=this._y+"px",this._element.style.left=this._x+"px",this.body.genBody(this._selectedCommands,this._cancelCommand),this._active=!0,this._setStart(),this.body.select(this.getDirection()),this.emitter.emit("menuOpened",t)}_selected(){this._element.style.display="none",this._active=!1;let t=this.getDirection(),n=t>this._selectedCommands.length?this._cancelCommand:this._selectedCommands[t];if(this.emitter.emit("menuClosed"),!n)return;if(this.emitter.emit("commandSelected",n),"go"in n){this._openMenu(n.go);return}if("action"in n)n.action(),this.emitter.emit("commandExecuted",n);else this._logFn("Unknown command type",n)}getDirection(t){if(!t)t=D(this._startX,this._startY,this._x,this._y);return L(t,this._selectedCommands.length)}_setStart(t=this._x,n=this._y){this._startX=t,this._startY=n}setRadius(t){this.body.radius=t}go(t){this._openMenu(t)}}var W=new URLSearchParams(window.location.search).has("lang"),d;if(!W)d=await fetch("./resource.json").then((t)=>t.json());else{let t=location.origin+(location.pathname+"/").replace("//","/")+"resource.json",n=await E(`
Instruction to use your own lang.
1. Open <a href="${t}" target="_blank">${t}</a>
2. Translate the text. Use e.g. Use AI to translate
3. Paste the result here
`.trim().replaceAll(`
`,"<br>"));if(n)try{d=JSON.parse(n)}catch(i){alert("Invalid JSON: "+i),location.reload()}else location.reload()}var h={hasTorch:!1,hasSword:!1,hasKey:!1,wolfDefeated:!1,guardBribed:!1},u={start:[{name:d.c.start[0],go:"forest"},{name:d.c.start[1],go:"castle"},{name:d.c.start[2],go:"village"},{name:d.c.start[3],go:"cave"}],forest:[{name:d.c.forest[0],action:()=>c(d.m.gatherBerries)},{name:d.c.forest[1],action:j},{name:d.c.forest[2],action:()=>c(d.m.findStream)},{name:d.c.forest[3],go:"deep_forest"},{name:d.c.forest[4],go:"start"}],deep_forest:[{name:d.c.deep_forest[0],action:G},{name:d.c.deep_forest[1],action:()=>c(d.m.lookForHerbs)},{name:d.c.deep_forest[2],go:"forest"}],castle:[{name:d.c.castle[0],go:"throne_room"},{name:d.c.castle[1],action:N},{name:d.c.castle[2],action:()=>c(d.m.exploreGarden)},{name:d.c.castle[3],go:"dungeon"},{name:d.c.castle[4],go:"start"}],throne_room:[{name:d.c.throne_room[0],action:U},{name:d.c.throne_room[1],action:Z},{name:d.c.throne_room[2],go:"castle"}],dungeon:[{name:d.c.dungeon[0],action:S},{name:d.c.dungeon[1],action:()=>c(d.m.listenToVoices)},{name:d.c.dungeon[2],go:"castle"}],village:[{name:d.c.village[0],action:J},{name:d.c.village[1],action:()=>c(d.m.talkToShopkeeper)},{name:d.c.village[2],action:Q},{name:d.c.village[3],go:"start"}],cave:[{name:d.c.cave[0],go:"deep_cave"},{name:d.c.cave[1],action:V},{name:d.c.cave[2],action:()=>{if(h.hasTorch)c(d.m.lightMatchWithTorch);else c(d.m.lightMatchWithoutTorch)}},{name:d.c.cave[3],go:"start"}],deep_cave:[{name:d.c.deep_cave[0],action:tt},{name:d.c.deep_cave[1],action:nt},{name:d.c.deep_cave[2],go:"cave"}]};function j(){if(Math.random()>0.5&&!h.hasTorch)h.hasTorch=!0,c(d.m.searchForestFound);else c(d.m.searchForestNotFound)}function G(){if(h.hasSword&&!h.wolfDefeated)h.wolfDefeated=!0,c(d.m.encounterWolfWithSword),u.deep_forest=u.deep_forest.filter((t)=>t.name!==d.c.deep_forest[0]),u.deep_forest.unshift({name:d.m.examineWolfsDen,action:()=>c(d.m.examineWolfsDen)});else if(!h.wolfDefeated)c(d.m.encounterWolfWithoutSword)}function N(){if(h.guardBribed)c(d.m.talkToGuardBribed);else c(d.m.talkToGuardNotBribed)}function J(){if(!h.hasSword)h.hasSword=!0,c(d.m.talkToBlacksmithNoSword);else c(d.m.talkToBlacksmithWithSword)}function Q(){if(c(d.m.helpBeggar),!u.castle.find((t)=>t.name===d.dynamicCommands.bribeGuard))u.castle.push({name:d.dynamicCommands.bribeGuard,action:()=>{h.guardBribed=!0,c(d.m.bribeGuard)}})}function U(){if(h.guardBribed||h.hasKey)c(d.m.approachThroneAuthorized);else c(d.m.approachThroneUnauthorized)}function Z(){if(h.hasKey)c(d.m.examineChestWithKey);else c(d.m.examineChestWithoutKey)}function S(){if(!h.hasKey)h.hasKey=!0,c(d.m.searchDungeonFound);else c(d.m.searchDungeonNotFound)}function V(){if(!h.hasTorch)c(d.m.searchCaveWithoutTorch);else c(d.m.searchCaveWithTorch)}function tt(){if(h.hasTorch)c(d.m.exploreLeftTunnelWithTorch);else c(d.m.exploreLeftTunnelWithoutTorch)}function nt(){c(d.m.exploreRightTunnel)}var I=qs(".wolf"),x=new H(u,I);x.init();x.emitter.on("distance",(t)=>{let n=x.body._actualRadius+x.distanceCount,a=`color-mix(in srgb, var(--accent) ${Math.min(100,Math.max(0,Math.round(t/n*100)))}%, white)`;I.style.setProperty("--color",a)});export{u as commands};

//# debugId=D56203207DE3269264756E2164756E21
//# sourceMappingURL=index.js.map
