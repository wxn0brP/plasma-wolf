function f(t){return new Promise((e)=>setTimeout(e,t))}(()=>{var t=Object.defineProperty,e=(n,i)=>t(n,"name",{value:i,configurable:!0}),o={html(n){return n!==void 0?(this.innerHTML=n,this):this.innerHTML},v(n){return n!==void 0?(this.value=n,this):this.value},on(n,i){return this.addEventListener(n,i),this},css(n,i=null){return typeof n=="string"?i!==null?this.style[n]=i:this.style.cssText=n:Object.assign(this.style,n),this},attrib(n,i=null){return i!==null?(this.setAttribute(n,i),this):this.getAttribute(n)||""},clA(...n){return this.classList.add(...n),this},clR(...n){return this.classList.remove(...n),this},clT(n,i){return this.classList.toggle(n,i),this},animateFade(n,i={}){let{time:c=200,cb:a}=i,d=this,r=n===0?1:0,m=Math.min(1,Math.max(0,n)),u=performance.now();d.style.opacity=m.toString();function p(h){let F=h-u,L=Math.min(F/c,1),S=m+(r-m)*L;d.style.opacity=S.toString(),L<1?requestAnimationFrame(p):(d.style.opacity=r.toString(),a?.())}return e(p,"step"),requestAnimationFrame(p),this},fadeIn(...n){let i=s({display:"string",cb:"function",time:"number"},n),{display:c="block"}=i;return this.css("display",c),this.animateFade(0,i),this.fade=!0,this},fadeOut(...n){let i=s({cb:"function",time:"number"},n),c=i.time??300;return i.time=c,this.animateFade(1,{...i,cb:e(()=>{this.css("display","none"),i.cb?.()},"cb")}),this.fade=!1,this},async fadeInP(...n){return new Promise((i)=>{this.fadeIn(...n,()=>i(this))})},async fadeOutP(...n){return new Promise((i)=>{this.fadeOut(...n,()=>i(this))})},fade:!0,fadeToggle(){return this.fade?this.fadeOut():this.fadeIn(),this},add(n){return this.appendChild(n),this},addUp(n){return this.insertBefore(n,this.firstChild),this},qs(n,i=0){return i&&(n=`[data-id="${n}"]`),this.querySelector(n)},qi(n,i=0){return this.qs(n,i)}};function s(n,i){let c={};if(i.length===0)return c;if(i.every((a)=>typeof a=="object"))return Object.assign({},...i);for(let a of i)for(let[d,r]of Object.entries(n))if(typeof a===r){c[d]=a;break}return c}e(s,"convert"),Object.assign(HTMLElement.prototype,o),Object.assign(document,o),Object.assign(document.body,o),Object.assign(document.documentElement,o);for(let n of["qs","qi"])typeof o[n]=="function"&&(window[n]=function(...i){return o[n].apply(document,i)})})();var C=qs("#FD-message"),b=qs("#FD-prompt"),O=(t,...e)=>{return t.replace(/\\\$|(?<!\\)\$/g,(o)=>{if(o==="\\$")return"$";return e.shift()?.toString()||"$"})};async function D(t,e={}){e={displayTime:6000,...e};let o=document.createElement("div");if(o.innerHTML=t,o.style.top=`-${o.offsetHeight+20}px`,e.className)o.classList.add(e.className);if(e.backgroundColor)o.style.backgroundColor=e.backgroundColor;let s=10,n=i();function i(){let d=0;for(let r of C.children)d+=r.offsetHeight+s;return d}let c=!1;async function a(){c=!0,o.style.top=`-${o.offsetHeight+20}px`,await f(700);for(let d of C.children){let r=d,m=parseInt(r.style.top.replace("px",""));r.style.top=`${m-s-o.offsetHeight}px`}o.remove()}if(o.addEventListener("click",a),e.onClick)o.addEventListener("click",e.onClick);if(C.appendChild(o),await f(100),o.style.top=`${10+n}px`,await f(e.displayTime-700),c)return;await a()}async function l(t,e={}){e={extraTime:0,...e};let o=0.3333333333333333,n={displayTime:(t.split(" ").length*o+6+e.extraTime)*1000,className:"uiMsg"};if(e.onClick)n.onClick=e.onClick;D(t,n)}async function $(t,...e){let o="";if(e.length>0){if(Array.isArray(e[0]))o=e.shift()}t=O(t,...e)+o,l(t)}async function R(t,e=""){return new Promise((o)=>{function s(){o(i.value),n.fadeOut(),setTimeout(()=>{n.remove()},2000)}let n=document.createElement("div");n.style.opacity="0",n.classList.add("prompt"),n.innerHTML="<p>"+t+"<p><br />";let i=document.createElement("input");i.type="text",i.value=e,i.addEventListener("keydown",(a)=>{if(a.key=="Enter")s()}),n.appendChild(i),setTimeout(()=>{i.focus()},100),n.appendChild(document.createElement("br"));let c=document.createElement("button");c.innerHTML="OK",n.appendChild(c),c.addEventListener("click",s),b.appendChild(n),n.fadeIn()})}async function I(t,e="OK",o="Cancel"){return new Promise((s)=>{function n(m){return()=>{s(m),i.fadeOut(),setTimeout(()=>{i.remove()},2000)}}let i=document.createElement("div");i.style.opacity="0",i.classList.add("prompt"),i.innerHTML="<p>"+t+"<p><br />";let c=document.createElement("div");c.style.display="flex",c.style.justifyContent="space-evenly";let a=document.createElement("button");a.innerHTML=o||"Cancel",a.addEventListener("click",n(!1)),c.appendChild(a);let d=document.createElement("button");d.innerHTML=e||"OK",d.addEventListener("click",n(!0)),c.appendChild(d);function r(m){if(m.key=="Enter")n(!0)();else if(m.key=="Escape")n(!1)();document.removeEventListener("keydown",r)}document.addEventListener("keydown",r),setTimeout(()=>{d.focus()},100),i.appendChild(c),b.appendChild(i),i.fadeIn()})}async function P(t,e,o=[],s=[]){return new Promise((n)=>{function i(){n(a.value),c.fadeOut(),setTimeout(()=>{c.remove()},2000)}let c=document.createElement("div");c.style.opacity="0",c.classList.add("prompt"),c.innerHTML="<p>"+t+"<p><br />";let a=document.createElement("select");for(let r=0;r<s.length;r++){let m=s[r],u=document.createElement("optgroup");u.label=m.name;for(let p=0;p<m.options.length;p++){let h=document.createElement("option");h.value=m.options[p]||m.options[p],h.innerHTML=m.options[p],u.appendChild(h)}a.appendChild(u)}for(let r=0;r<e.length;r++){let m=document.createElement("option");m.value=o[r]||e[r],m.innerHTML=e[r],a.appendChild(m)}a.querySelector("option").selected=!0,c.appendChild(a),c.appendChild(document.createElement("br"));let d=document.createElement("button");d.innerHTML="OK",c.appendChild(d),d.addEventListener("click",i),b.appendChild(c),c.fadeIn()})}async function B(t,e="datetime-local",o,s){return new Promise((n)=>{function i(){n(a.value),c.fadeOut(),setTimeout(()=>{c.remove()},2000)}let c=document.createElement("div");c.style.opacity="0",c.classList.add("prompt"),c.innerHTML="<p>"+t+"<p><br />";let a=document.createElement("input");if(a.type=e,a.value="00:00",o)a.min=new Date(o).toISOString();if(s)a.max=new Date(s).toISOString();a.addEventListener("keydown",(r)=>{if(r.key=="Enter")i()}),c.appendChild(a),setTimeout(()=>{a.focus()},100),c.appendChild(document.createElement("br"));let d=document.createElement("button");d.innerHTML="OK",c.appendChild(d),d.addEventListener("click",i),b.appendChild(c),c.fadeIn()})}window.FD={uiMessage:D,uiMsg:l,uiMsgT:$,confirm:I,prompt:R,selectPrompt:P,promptTime:B};class k{dx;dy;constructor(t,e){this.dx=t;this.dy=e}}function _(t,e,o=55){let{dx:s,dy:n}=t;if(s===0&&n===0)return e;let i=Math.abs(s),c=Math.abs(n);if(i<o&&c<o)return e;let a=X(t),d=360/e/2,r=a+90+d;return z(r,e)}function X(t){let e=Math.atan2(t.dy,t.dx);if(e=e*(180/Math.PI),e<0)e+=360;return e}function z(t,e){let o=360/e,s=Math.floor(t/o);return s=s%e,s}function T({dx:t,dy:e}){return Math.sqrt(t*t+e*e)}function M(t,e){let o=[],s=2*Math.PI/e;for(let n=0;n<e;n++){let i=n*s-Math.PI/2,c=t*Math.cos(i),a=t*Math.sin(i);o.push(Math.round(c),Math.round(a))}return o}function x(t,e,o,s){return new k(o-t,s-e)}function H(t){let s=102+6*t;if(t>8)s+=(t-8)*4;return s}class v{parent;radius;constructor(t,e=0){this.parent=t;this.radius=e;this.parent.innerHTML="",this._actualRadius=e}body=[];selectedClass="selected";_actualRadius;genBody(t,e){this.parent.innerHTML="",this.body=[];let o=M(this._getRadius(t.length),t.length);for(let n=0;n<t.length;n++){let i=document.createElement("div");i.classList.add("wolf-menu-item"),i.style.left=`${o[n*2]}px`,i.style.top=`${o[n*2+1]}px`,i.innerHTML=t[n].name,this.parent.appendChild(i),this.body.push(i)}let s=document.createElement("div");s.classList.add("wolf-menu-item"),s.classList.add("wolf-menu-item-cancel"),s.style.left="0",s.style.top="0",s.innerHTML=e.name,this.parent.appendChild(s),this.body.push(s)}_getRadius(t){if(this.radius===0)this._actualRadius=H(t);else this._actualRadius=this.radius;return this._actualRadius}clearSelected(){this.body.forEach((t)=>t.classList.remove(this.selectedClass))}select(t){this.body[t].classList.add(this.selectedClass)}}class g{_events={};on(t,e){let o=t;if(!this._events[o])this._events[o]=[];this._events[o].push(e)}once(t,e){let o=(...s)=>{this.off(t,o),e(...s)};this.on(t,o)}off(t,e){let o=t;if(!this._events[o])return;this._events[o]=this._events[o].filter((s)=>s!==e)}emit(t,...e){let o=this._events[t];if(o&&o.length>0)o.forEach((s)=>{s(...e)})}listenerCount(t){return this._events[t]?.length||0}}class E{_commands;_element;constructor(t,e){this._commands=t;this._element=e;let o=document.createElement("div");o.classList.add("wolf-menu-items"),this._element.appendChild(o),this.body=new v(o),this._element.style.display="none"}_x=0;_y=0;_startX=0;_startY=0;_active=!1;_selectedCommands;_logFn=console.log;_cancelCommand={name:"Cancel",action:()=>{}};body;emitter=new g;distanceAccept=!0;distanceCount=60;startCommand="start";init(){this._initMove(),this._initClick(),this.emitter.emit("initialized")}_initMove(){document.addEventListener("mousemove",(t)=>{if(this._x=t.clientX,this._y=t.clientY,!this._active)return;this.body.clearSelected();let e=x(this._startX,this._startY,this._x,this._y),o=_(e,this._selectedCommands.length);this.body.select(o);let s=T(e);if(this.emitter.emit("distance",s,o),!this.distanceAccept)return;if(s>this.body._actualRadius+this.distanceCount)this._selected()})}_initClick(){document.addEventListener("click",(t)=>{if(this._x=t.clientX,this._y=t.clientY,this._active)this._selected();else this._openMenu()})}_openMenu(t=this.startCommand){if(this._selectedCommands=this._commands[t],!this._selectedCommands)return this._logFn(`Command "${t}" not found!`);this._element.style.display="",this._element.style.top=this._y+"px",this._element.style.left=this._x+"px",this.body.genBody(this._selectedCommands,this._cancelCommand),this._active=!0,this._setStart(),this.body.select(this.getDirection()),this.emitter.emit("menuOpened",t)}_selected(){this._element.style.display="none",this._active=!1;let t=this.getDirection(),e=t>this._selectedCommands.length?this._cancelCommand:this._selectedCommands[t];if(this.emitter.emit("menuClosed"),!e)return;if(this.emitter.emit("commandSelected",e),"go"in e){this._openMenu(e.go);return}if("action"in e)e.action(),this.emitter.emit("commandExecuted",e);else this._logFn("Unknown command type",e)}getDirection(t){if(!t)t=x(this._startX,this._startY,this._x,this._y);return _(t,this._selectedCommands.length)}_setStart(t=this._x,e=this._y){this._startX=t,this._startY=e}setRadius(t){this.body.radius=t}}var A={start:[{name:"Go to the forest",go:"forest"},{name:"Enter the castle",go:"castle"},{name:"Return to the village",go:"village"},{name:"Explore the cave",go:"cave"}],forest:[{name:"Gather berries",action:()=>l("You gathered some delicious berries.")},{name:"Take a rest",action:()=>l("You took a short rest.")},{name:"Find a stream",action:()=>l("You found a stream with cool, clear water.")},{name:"Go deeper in the forest",go:"deep_forest"},{name:"Return to the start",go:"start"},{name:"Light a fire",action:()=>l("You lit a fire and felt warm.")},{name:"Listen to the forest sounds",action:()=>l("You listened carefully and heard some soothing sounds.")},{name:"Take a break",action:()=>l("You took a short break.")}],castle:[{name:"Enter the throne room",go:"throne_room"},{name:"Talk to the guard",action:()=>l("The guard says: 'You cannot pass without permission.'")},{name:"Explore the garden",action:()=>l("The garden is empty and quiet.")},{name:"Enter the dungeon",go:"dungeon"},{name:"Return to the start",go:"start"},{name:"Visit the library",go:"library"},{name:"Use the lavatory",action:()=>l("You hear the sound of running water.")}],village:[{name:"Talk to the blacksmith",action:()=>l("Blacksmith: 'How can I help you with the new month?'")},{name:"Visit the shopkeeper",action:()=>l("Shopkeeper: 'Welcome to my humble shop.'")},{name:"Feed the beggar",action:()=>l("The beggar thanks you for the food.")},{name:"Return to the start",go:"start"},{name:"Get a drink",action:()=>l("You take a refreshing drink.")},{name:"Take a walk at night",go:"forest"}],cave:[{name:"Go deeper",go:"deep_cave"},{name:"Write on the wall",action:()=>l("You write an old rhyme on the wall.")},{name:"Light a match",action:()=>l("The match flickers and casts a small, warm glow.")},{name:"Shout",action:()=>l("Your voice echoes off the walls... and something else.")},{name:"Return to the start",go:"start"},{name:"Bang on the pipe",action:()=>l("The pipe makes a loud, hollow clang.")},{name:"Repeat after the echo",action:()=>l("The echo repeats your words back to you.")},{name:"Take a break at the entrance",action:()=>l("You take a short break at the entrance.")}]},w=qs(".wolf"),y=new E(A,w);y.init();y.emitter.on("distance",(t)=>{let e=y.body._actualRadius+y.distanceCount,s=`color-mix(in srgb, var(--accent) ${Math.min(100,Math.max(0,Math.round(t/e*100)))}%, white)`;w.style.setProperty("--color",s)});export{A as commands};

//# debugId=A60CC79823C24B4A64756E2164756E21
//# sourceMappingURL=index.js.map
